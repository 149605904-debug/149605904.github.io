<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>桑基图 - 数据流向分析 (1980-2024)</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .description {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        #chart {
            width: 100%;
            height: 700px;
        }
        .footer {
            text-align: center;
            margin-top: 20px;
            color: #95a5a6;
            font-size: 0.9em;
        }
        .legend {
            display: flex;
            justify-content: center;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 0 10px;
        }
        .legend-color {
            width: 15px;
            height: 15px;
            margin-right: 5px;
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>数据流向桑基图 (1980-2024)</h1>
        <p class="description">此图表展示了从1980年到2024年间，数据在不同集群之间的流向情况。左侧年份节点颜色根据其主要流向的集群决定。</p>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background-color: #1E90FF;"></div>
                <span>Cluster 1 (湖蓝)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #87CEEB;"></div>
                <span>Cluster 2 (天蓝)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #4169E1;"></div>
                <span>Cluster 3 (群青)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #191970;"></div>
                <span>Cluster 4 (普蓝)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #20B2AA;"></div>
                <span>Cluster 5 (蓝绿)</span>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background-color: #4682B4;"></div>
                <span>Cluster 6 (钢蓝)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #5F9EA0;"></div>
                <span>Cluster 7 (青蓝)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #708090;"></div>
                <span>Cluster 8 (灰蓝)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #B0C4DE;"></div>
                <span>Cluster 9 (淡蓝)</span>
            </div>
        </div>
        
        <div id="chart"></div>
        <div class="footer">
            数据来源：提供的数据集 | 可视化：ECharts
        </div>
    </div>

    <script>
        // 初始化图表
        var chartDom = document.getElementById('chart');
        var myChart = echarts.init(chartDom);
        
        // 显示加载动画
        myChart.showLoading();
        
        // 处理数据
        var csvData = `source,target,value
1980,Cluster 1,5
1980,Cluster 2,2
1980,Cluster 3,53
1980,Cluster 4,17
1980,Cluster 5,1
1980,Cluster 6,6
1980,Cluster 7,0
1980,Cluster 8,7
1980,Cluster 9,0
1982,Cluster 1,0
1982,Cluster 2,0
1982,Cluster 3,14
1982,Cluster 4,3
1982,Cluster 5,0
1982,Cluster 6,0
1982,Cluster 7,0
1982,Cluster 8,0
1982,Cluster 9,0
1983,Cluster 1,1
1983,Cluster 2,0
1983,Cluster 3,18
1983,Cluster 4,4
1983,Cluster 5,1
1983,Cluster 6,2
1983,Cluster 7,3
1983,Cluster 8,7
1983,Cluster 9,0
1984,Cluster 1,1
1984,Cluster 2,2
1984,Cluster 3,5
1984,Cluster 4,4
1984,Cluster 5,3
1984,Cluster 6,0
1984,Cluster 7,0
1984,Cluster 8,2
1984,Cluster 9,0
1985,Cluster 1,6
1985,Cluster 2,1
1985,Cluster 3,20
1985,Cluster 4,4
1985,Cluster 5,10
1985,Cluster 6,1
1985,Cluster 7,1
1985,Cluster 8,21
1985,Cluster 9,1
1986,Cluster 1,4
1986,Cluster 2,8
1986,Cluster 3,24
1986,Cluster 4,9
1986,Cluster 5,9
1986,Cluster 6,0
1986,Cluster 7,0
1986,Cluster 8,26
1986,Cluster 9,0
1987,Cluster 1,1
1987,Cluster 2,1
1987,Cluster 3,27
1987,Cluster 4,11
1987,Cluster 5,8
1987,Cluster 6,1
1987,Cluster 7,2
1987,Cluster 8,23
1987,Cluster 9,0
1988,Cluster 1,0
1988,Cluster 2,6
1988,Cluster 3,32
1988,Cluster 4,4
1988,Cluster 5,4
1988,Cluster 6,2
1988,Cluster 7,1
1988,Cluster 8,22
1988,Cluster 9,0
1989,Cluster 1,2
1989,Cluster 2,1
1989,Cluster 3,37
1989,Cluster 4,2
1989,Cluster 5,2
1989,Cluster 6,0
1989,Cluster 7,4
1989,Cluster 8,27
1989,Cluster 9,1
1990,Cluster 1,4
1990,Cluster 2,3
1990,Cluster 3,35
1990,Cluster 4,5
1990,Cluster 5,2
1990,Cluster 6,7
1990,Cluster 7,2
1990,Cluster 8,26
1990,Cluster 9,2
1991,Cluster 1,20
1991,Cluster 2,4
1991,Cluster 3,41
1991,Cluster 4,7
1991,Cluster 5,5
1991,Cluster 6,1
1991,Cluster 7,1
1991,Cluster 8,19
1991,Cluster 9,1
1992,Cluster 1,6
1992,Cluster 2,5
1992,Cluster 3,44
1992,Cluster 4,5
1992,Cluster 5,1
1992,Cluster 6,4
1992,Cluster 7,0
1992,Cluster 8,25
1992,Cluster 9,0
1993,Cluster 1,2
1993,Cluster 2,6
1993,Cluster 3,29
1993,Cluster 4,3
1993,Cluster 5,2
1993,Cluster 6,5
1993,Cluster 7,4
1993,Cluster 8,29
1993,Cluster 9,1
1994,Cluster 1,5
1994,Cluster 2,2
1994,Cluster 3,29
1994,Cluster 4,1
1994,Cluster 5,3
1994,Cluster 6,0
1994,Cluster 7,1
1994,Cluster 8,35
1994,Cluster 9,0
1995,Cluster 1,6
1995,Cluster 2,9
1995,Cluster 3,38
1995,Cluster 4,3
1995,Cluster 5,6
1995,Cluster 6,3
1995,Cluster 7,6
1995,Cluster 8,42
1995,Cluster 9,0
1996,Cluster 1,9
1996,Cluster 2,12
1996,Cluster 3,25
1996,Cluster 4,3
1996,Cluster 5,1
1996,Cluster 6,3
1996,Cluster 7,5
1996,Cluster 8,56
1996,Cluster 9,1
1997,Cluster 1,6
1997,Cluster 2,8
1997,Cluster 3,40
1997,Cluster 4,10
1997,Cluster 5,10
1997,Cluster 6,1
1997,Cluster 7,14
1997,Cluster 8,27
1997,Cluster 9,6
1998,Cluster 1,5
1998,Cluster 2,8
1998,Cluster 3,41
1998,Cluster 4,8
1998,Cluster 5,5
1998,Cluster 6,5
1998,Cluster 7,8
1998,Cluster 8,66
1998,Cluster 9,2
1999,Cluster 1,3
1999,Cluster 2,7
1999,Cluster 3,38
1999,Cluster 4,10
1999,Cluster 5,7
1999,Cluster 6,0
1999,Cluster 7,5
1999,Cluster 8,44
1999,Cluster 9,4
2000,Cluster 1,8
2000,Cluster 2,3
2000,Cluster 3,45
2000,Cluster 4,8
2000,Cluster 5,2
2000,Cluster 6,6
2000,Cluster 7,6
2000,Cluster 8,47
2000,Cluster 9,1
2001,Cluster 1,7
2001,Cluster 2,10
2001,Cluster 3,38
2001,Cluster 4,3
2001,Cluster 5,6
2001,Cluster 6,5
2001,Cluster 7,6
2001,Cluster 8,39
2001,Cluster 9,1
2002,Cluster 1,30
2002,Cluster 2,25
2002,Cluster 3,77
2002,Cluster 4,12
2002,Cluster 5,11
2002,Cluster 6,12
2002,Cluster 7,23
2002,Cluster 8,117
2002,Cluster 9,20
2003,Cluster 1,43
2003,Cluster 2,35
2003,Cluster 3,114
2003,Cluster 4,24
2003,Cluster 5,20
2003,Cluster 6,18
2003,Cluster 7,24
2003,Cluster 8,159
2003,Cluster 9,22
2004,Cluster 1,43
2004,Cluster 2,42
2004,Cluster 3,83
2004,Cluster 4,29
2004,Cluster 5,19
2004,Cluster 6,15
2004,Cluster 7,28
2004,Cluster 8,188
2004,Cluster 9,19
2005,Cluster 1,46
2005,Cluster 2,49
2005,Cluster 3,135
2005,Cluster 4,52
2005,Cluster 5,24
2005,Cluster 6,28
2005,Cluster 7,51
2005,Cluster 8,292
2005,Cluster 9,40
2006,Cluster 1,66
2006,Cluster 2,52
2006,Cluster 3,152
2006,Cluster 4,43
2006,Cluster 5,25
2006,Cluster 6,35
2006,Cluster 7,65
2006,Cluster 8,269
2006,Cluster 9,54
2007,Cluster 1,35
2007,Cluster 2,30
2007,Cluster 3,93
2007,Cluster 4,40
2007,Cluster 5,22
2007,Cluster 6,17
2007,Cluster 7,39
2007,Cluster 8,204
2007,Cluster 9,29
2008,Cluster 1,41
2008,Cluster 2,32
2008,Cluster 3,88
2008,Cluster 4,26
2008,Cluster 5,23
2008,Cluster 6,20
2008,Cluster 7,41
2008,Cluster 8,167
2008,Cluster 9,21
2009,Cluster 1,47
2009,Cluster 2,32
2009,Cluster 3,78
2009,Cluster 4,28
2009,Cluster 5,11
2009,Cluster 6,23
2009,Cluster 7,34
2009,Cluster 8,119
2009,Cluster 9,24
2010,Cluster 1,48
2010,Cluster 2,29
2010,Cluster 3,77
2010,Cluster 4,29
2010,Cluster 5,14
2010,Cluster 6,26
2010,Cluster 7,28
2010,Cluster 8,141
2010,Cluster 9,30
2011,Cluster 1,61
2011,Cluster 2,30
2011,Cluster 3,87
2011,Cluster 4,28
2011,Cluster 5,12
2011,Cluster 6,15
2011,Cluster 7,28
2011,Cluster 8,147
2011,Cluster 9,30
2012,Cluster 1,60
2012,Cluster 2,38
2012,Cluster 3,90
2012,Cluster 4,32
2012,Cluster 5,22
2012,Cluster 6,24
2012,Cluster 7,24
2012,Cluster 8,142
2012,Cluster 9,29
2013,Cluster 1,59
2013,Cluster 2,44
2013,Cluster 3,103
2013,Cluster 4,24
2013,Cluster 5,9
2013,Cluster 6,14
2013,Cluster 7,24
2013,Cluster 8,158
2013,Cluster 9,21
2014,Cluster 1,48
2014,Cluster 2,40
2014,Cluster 3,96
2014,Cluster 4,39
2014,Cluster 5,13
2014,Cluster 6,14
2014,Cluster 7,37
2014,Cluster 8,123
2014,Cluster 9,37
2015,Cluster 1,41
2015,Cluster 2,48
2015,Cluster 3,128
2015,Cluster 4,45
2015,Cluster 5,4
2015,Cluster 6,20
2015,Cluster 7,41
2015,Cluster 8,138
2015,Cluster 9,39
2016,Cluster 1,53
2016,Cluster 2,66
2016,Cluster 3,102
2016,Cluster 4,26
2016,Cluster 5,2
2016,Cluster 6,15
2016,Cluster 7,27
2016,Cluster 8,120
2016,Cluster 9,27
2017,Cluster 1,36
2017,Cluster 2,43
2017,Cluster 3,112
2017,Cluster 4,29
2017,Cluster 5,4
2017,Cluster 6,12
2017,Cluster 7,24
2017,Cluster 8,116
2017,Cluster 9,34
2018,Cluster 1,32
2018,Cluster 2,43
2018,Cluster 3,66
2018,Cluster 4,22
2018,Cluster 5,8
2018,Cluster 6,15
2018,Cluster 7,33
2018,Cluster 8,114
2018,Cluster 9,42
2019,Cluster 1,54
2019,Cluster 2,31
2019,Cluster 3,79
2019,Cluster 4,20
2019,Cluster 5,5
2019,Cluster 6,9
2019,Cluster 7,26
2019,Cluster 8,109
2019,Cluster 9,33
2020,Cluster 1,42
2020,Cluster 2,58
2020,Cluster 3,75
2020,Cluster 4,13
2020,Cluster 5,4
2020,Cluster 6,7
2020,Cluster 7,27
2020,Cluster 8,106
2020,Cluster 9,36
2021,Cluster 1,32
2021,Cluster 2,45
2021,Cluster 3,69
2021,Cluster 4,26
2021,Cluster 5,4
2021,Cluster 6,8
2021,Cluster 7,13
2021,Cluster 8,101
2021,Cluster 9,36
2022,Cluster 1,25
2022,Cluster 2,42
2022,Cluster 3,56
2022,Cluster 4,14
2022,Cluster 5,4
2022,Cluster 6,4
2022,Cluster 7,18
2022,Cluster 8,97
2022,Cluster 9,43
2023,Cluster 1,30
2023,Cluster 2,32
2023,Cluster 3,36
2023,Cluster 4,15
2023,Cluster 5,6
2023,Cluster 6,7
2023,Cluster 7,22
2023,Cluster 8,99
2023,Cluster 9,36
2024,Cluster 1,33
2024,Cluster 2,30
2024,Cluster 3,29
2024,Cluster 4,17
2024,Cluster 5,7
2024,Cluster 6,7
2024,Cluster 7,24
2024,Cluster 8,96
2024,Cluster 9,34`;

        // 解析CSV数据
        var lines = csvData.split('\n');
        var headers = lines[0].split(',');
        var data = [];
        
        for (var i = 1; i < lines.length; i++) {
            var line = lines[i].trim();
            if (line) {
                var values = line.split(',');
                var obj = {};
                for (var j = 0; j < headers.length; j++) {
                    obj[headers[j]] = values[j];
                }
                data.push(obj);
            }
        }
        
        // 为集群定义颜色
        var clusterColors = {
            'Cluster 1': '#1E90FF', // 湖蓝
            'Cluster 2': '#87CEEB', // 天蓝
            'Cluster 3': '#4169E1', // 群青
            'Cluster 4': '#191970', // 普蓝
            'Cluster 5': '#20B2AA', // 蓝绿
            'Cluster 6': '#4682B4', // 钢蓝
            'Cluster 7': '#5F9EA0', // 青蓝
            'Cluster 8': '#708090', // 灰蓝
            'Cluster 9': '#B0C4DE'  // 淡蓝
        };
        
        // 提取所有唯一的节点
        var nodesMap = {};
        var nodes = [];
        var links = [];
        
        // 计算每个年份的主要流向集群
        var yearMainCluster = {};
        data.forEach(function(item) {
            var source = item.source;
            var target = item.target;
            var value = parseInt(item.value);
            
            // 跳过值为0的链接
            if (value === 0) return;
            
            // 记录每个年份流向每个集群的值
            if (!yearMainCluster[source]) {
                yearMainCluster[source] = {};
            }
            if (!yearMainCluster[source][target]) {
                yearMainCluster[source][target] = 0;
            }
            yearMainCluster[source][target] += value;
        });
        
        // 确定每个年份的主要集群（值最大的集群）
        var yearColors = {};
        for (var year in yearMainCluster) {
            var maxValue = 0;
            var mainCluster = '';
            for (var cluster in yearMainCluster[year]) {
                if (yearMainCluster[year][cluster] > maxValue) {
                    maxValue = yearMainCluster[year][cluster];
                    mainCluster = cluster;
                }
            }
            yearColors[year] = clusterColors[mainCluster];
        }
        
        // 处理数据，创建节点和链接
        data.forEach(function(item) {
            var source = item.source;
            var target = item.target;
            var value = parseInt(item.value);
            
            // 跳过值为0的链接
            if (value === 0) return;
            
            // 添加源节点（年份）
            if (!nodesMap[source]) {
                nodesMap[source] = true;
                nodes.push({ 
                    name: source,
                    itemStyle: {
                        color: yearColors[source]
                    }
                });
            }
            
            // 添加目标节点（集群）
            if (!nodesMap[target]) {
                nodesMap[target] = true;
                nodes.push({ 
                    name: target,
                    itemStyle: {
                        color: clusterColors[target]
                    }
                });
            }
            
            // 添加链接
            links.push({
                source: source,
                target: target,
                value: value
            });
        });
        
        // 根据年份对节点进行排序
        nodes.sort(function(a, b) {
            // 如果是年份节点，按数字排序
            if (!isNaN(a.name) && !isNaN(b.name)) {
                return parseInt(a.name) - parseInt(b.name);
            }
            // 如果是集群节点，按集群编号排序
            else if (a.name.startsWith('Cluster') && b.name.startsWith('Cluster')) {
                return parseInt(a.name.split(' ')[1]) - parseInt(b.name.split(' ')[1]);
            }
            // 年份节点排在前面
            else if (!isNaN(a.name)) {
                return -1;
            } else {
                return 1;
            }
        });
        
        // 隐藏加载动画
        myChart.hideLoading();
        
        // 设置图表选项
        var option = {
            title: {
                text: '数据流向桑基图 (1980-2024)',
                left: 'center',
                textStyle: {
                    fontSize: 20,
                    fontWeight: 'bold'
                }
            },
            tooltip: {
                trigger: 'item',
                triggerOn: 'mousemove',
                formatter: function(params) {
                    if (params.dataType === 'node') {
                        return params.name + ': ' + (params.value || '');
                    } else {
                        return params.data.source + ' → ' + params.data.target + '<br/>值: ' + params.data.value;
                    }
                }
            },
            series: [{
                type: 'sankey',
                layout: 'none',
                data: nodes,
                links: links,
                emphasis: {
                    focus: 'adjacency'
                },
                lineStyle: {
                    color: 'gradient',
                    curveness: 0.5,
                    opacity: 0.6
                },
                label: {
                    fontSize: 12
                },
                nodeWidth: 15,
                nodeGap: 10
            }]
        };
        
        // 设置图表
        myChart.setOption(option);
        
        // 响应窗口大小变化
        window.addEventListener('resize', function() {
            myChart.resize();
        });
    </script>
</body>
</html>